from google.generativeai.types import FunctionDeclaration, Tool


# Определение инструмента для получения всех услуг
get_all_services_declaration = FunctionDeclaration(
    name="get_all_services",
    description=(
        "Получает полный список всех доступных услуг салона красоты. "
        "Используй эту функцию, когда клиент спрашивает о том, какие услуги доступны, "
        "что можно сделать в салоне, или когда нужно показать прайс-лист. "
        "Функция возвращает название услуги, цену и длительность."
    ),
    parameters={
        "type": "object",
        "properties": {},
        "required": []
    }
)


# Определение инструмента для поиска мастеров по услуге
get_masters_for_service_declaration = FunctionDeclaration(
    name="get_masters_for_service",
    description=(
        "Находит мастеров, которые выполняют конкретную услугу. "
        "Используй эту функцию, когда клиент уже определился с услугой и хочет узнать, "
        "какие мастера могут её выполнить. Например, если клиент сказал 'Я хочу женскую стрижку' "
        "или 'Покажи мастеров для маникюра'. Функция принимает точное название услуги."
    ),
    parameters={
        "type": "object",
        "properties": {
            "service_name": {
                "type": "string",
                "description": (
                    "Точное название услуги, для которой нужно найти мастеров. "
                    "Например: 'Женская стрижка', 'Мужская стрижка', 'Маникюр', 'Окрашивание волос'."
                )
            }
        },
        "required": ["service_name"]
    }
)


# Определение инструмента для получения свободных слотов
get_available_slots_declaration = FunctionDeclaration(
    name="get_available_slots",
    description=(
        "Получает список всех свободных временных интервалов для конкретной услуги на указанную дату. "
        "Функция возвращает СЫРЫЕ данные в формате интервалов (например, '10:15-13:45, 15:00-17:30'). "
        "Твоя задача — проанализировать эти данные и предложить клиенту наиболее подходящие варианты. "
        "Используй эту функцию, когда клиент хочет узнать доступное время для записи на услугу. "
        "Например: 'Когда можно записаться на женскую стрижку?' или 'Покажи свободное время для маникюра на завтра'."
    ),
    parameters={
        "type": "object",
        "properties": {
            "service_name": {
                "type": "string",
                "description": (
                    "Название услуги, для которой нужно найти свободные интервалы. "
                    "Например: 'Женская стрижка', 'Маникюр', 'Окрашивание волос'. "
                    "Точное название услуги из прайс-листа."
                )
            },
            "date": {
                "type": "string",
                "description": (
                    "Дата в формате YYYY-MM-DD (например, '2025-10-15'). "
                    "Если клиент говорит 'на завтра' или 'на понедельник', "
                    "нужно преобразовать это в конкретную дату."
                )
            }
        },
        "required": ["service_name", "date"]
    }
)


# Определение инструмента для создания записи
create_appointment_declaration = FunctionDeclaration(
    name="create_appointment",
    description=(
        "Создает запись в календаре для мастера и услуги. "
        "Если в системном контексте указано, что имя и телефон клиента сохранены в БД — НЕ спрашивай их повторно, просто создавай запись. "
        "Если данных нет — сначала уточни недостающее (имя и/или телефон), затем создай запись. "
        "Функция автоматически вычисляет время окончания на основе длительности услуги и создает событие в календаре."
    ),
    parameters={
        "type": "object",
        "properties": {
            "master_name": {
                "type": "string",
                "description": (
                    "Имя мастера, к которому записывается клиент. "
                    "Например: 'Анна', 'Мария', 'Елена'. "
                    "Должно точно соответствовать имени мастера из базы данных."
                )
            },
            "service_name": {
                "type": "string",
                "description": (
                    "Название услуги, на которую записывается клиент. "
                    "Например: 'Женская стрижка', 'Маникюр', 'Окрашивание волос'. "
                    "Должно точно соответствовать названию услуги из прайс-листа."
                )
            },
            "date": {
                "type": "string",
                "description": (
                    "Дата записи в формате YYYY-MM-DD (например, '2025-10-15'). "
                    "Если клиент говорит 'на завтра' или 'на понедельник', "
                    "нужно преобразовать это в конкретную дату."
                )
            },
            "time": {
                "type": "string",
                "description": (
                    "Время записи в формате HH:MM (например, '14:30', '10:00'). "
                    "Время должно быть в 24-часовом формате."
                )
            },
            "client_name": {
                "type": "string",
                "description": (
                    "Имя клиента, который записывается на услугу. "
                    "Это обязательный параметр - без имени запись не создается."
                )
            }
        },
        "required": ["master_name", "service_name", "date", "time", "client_name"]
    }
)


# Определение инструмента для просмотра записей пользователя
get_my_appointments_declaration = FunctionDeclaration(
    name="get_my_appointments",
    description=(
        "Получает все предстоящие записи пользователя в структурированном виде. "
        "Используй эту функцию, когда клиент хочет посмотреть свои записи, "
        "узнать когда у него назначена встреча, или проверить расписание. "
        "Например: 'Покажи мои записи', 'Когда у меня запись?', 'Какие у меня назначения?' "
        "Функция возвращает структурированные данные с ID записей для внутреннего использования."
    ),
    parameters={
        "type": "object",
        "properties": {},
        "required": []
    }
)


# Определение инструмента для отмены записи по ID
cancel_appointment_by_id_declaration = FunctionDeclaration(
    name="cancel_appointment_by_id",
    description=(
        "Отменяет запись по её ID. "
        "Используй эту функцию, когда клиент хочет отменить конкретную запись. "
        "ID записи должен быть определен на основе ранее показанного списка записей. "
        "Например: 'отмените мою запись на стрижку', 'отмените запись на завтра'."
    ),
    parameters={
        "type": "object",
        "properties": {
            "appointment_id": {
                "type": "integer",
                "description": (
                    "ID записи для отмены. "
                    "Этот ID должен быть определен на основе ранее показанного списка записей клиента."
                )
            }
        },
        "required": ["appointment_id"]
    }
)


# Определение инструмента для переноса записи по ID
reschedule_appointment_by_id_declaration = FunctionDeclaration(
    name="reschedule_appointment_by_id",
    description=(
        "Переносит запись на новую дату и время по её ID. "
        "Используй эту функцию, когда клиент хочет перенести конкретную запись. "
        "ID записи должен быть определен на основе ранее показанного списка записей. "
        "Например: 'перенесите мою запись на завтра', 'измените время записи на стрижку'."
    ),
    parameters={
        "type": "object",
        "properties": {
            "appointment_id": {
                "type": "integer",
                "description": (
                    "ID записи для переноса. "
                    "Этот ID должен быть определен на основе ранее показанного списка записей клиента."
                )
            },
            "new_date": {
                "type": "string",
                "description": (
                    "Новая дата записи в формате YYYY-MM-DD (например, '2025-10-15'). "
                    "Если клиент говорит 'на завтра' или 'на понедельник', "
                    "нужно преобразовать это в конкретную дату."
                )
            },
            "new_time": {
                "type": "string",
                "description": (
                    "Новое время записи в формате HH:MM (например, '14:30', '10:00'). "
                    "Время должно быть в 24-часовом формате."
                )
            }
        },
        "required": ["appointment_id", "new_date", "new_time"]
    }
)


# Определение инструмента для вызова менеджера
call_manager_declaration = FunctionDeclaration(
    name="call_manager",
    description=(
        "Вызывай эту функцию ТОЛЬКО в крайнем случае, если: "
        "1) Клиент выражает сильное недовольство, жалуется на качество или просит вернуть деньги. "
        "2) Запрос клиента очень нестандартный и требует принятия решения, которое не входит в твои полномочия (например, обсуждение особых скидок, партнерства). "
        "3) Клиент прямо просит позвать живого человека/менеджера. "
        "В параметре 'reason' кратко опиши причину вызова."
    ),
    parameters={
        "type": "object",
        "properties": {
            "reason": {
                "type": "string",
                "description": (
                    "Краткое описание причины вызова менеджера. "
                    "Например: 'Клиент недоволен качеством услуги', "
                    "'Запрос на особую скидку', 'Прямой запрос на менеджера'."
                )
            }
        },
        "required": ["reason"]
    }
)


# Создаем Tool объект, содержащий все наши функции
salon_tools = Tool(
    function_declarations=[
        get_all_services_declaration,
        get_masters_for_service_declaration,
        get_available_slots_declaration,
        create_appointment_declaration,
        get_my_appointments_declaration,
        cancel_appointment_by_id_declaration,
        reschedule_appointment_by_id_declaration,
        call_manager_declaration
    ]
)

