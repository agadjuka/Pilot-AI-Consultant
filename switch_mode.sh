#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –æ–±—ã—á–Ω—ã–º —Ä–µ–∂–∏–º–æ–º –∏ —Ä–µ–∂–∏–º–æ–º –∑–∞–≥–ª—É—à–∫–∏
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è webhook'–æ–≤ –±–µ–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

echo "üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."

if [ "$1" = "stub" ]; then
    echo "üîß –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –∑–∞–≥–ª—É—à–∫–∏ (–±–µ–∑ –ë–î)..."
    
    # –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    cp app/main.py app/main_original.py.bak
    cp app/api/telegram.py app/api/telegram_original.py.bak
    
    # –ó–∞–º–µ–Ω—è–µ–º –Ω–∞ –≤–µ—Ä—Å–∏–∏ —Å –∑–∞–≥–ª—É—à–∫–∞–º–∏
    cp app/main_stub.py app/main.py
    cp app/api/telegram_stub.py app/api/telegram.py
    
    echo "‚úÖ –†–µ–∂–∏–º –∑–∞–≥–ª—É—à–∫–∏ –≤–∫–ª—é—á–µ–Ω!"
    echo "üìä Webhook'–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
    echo "üéØ –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∑–∞–≥–ª—É—à–∫–∞–º–∏"
    
elif [ "$1" = "normal" ]; then
    echo "üîß –í–∫–ª—é—á–∞–µ–º –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º (—Å –ë–î)..."
    
    # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
    if [ -f "app/main_original.py.bak" ]; then
        cp app/main_original.py.bak app/main.py
        echo "‚úÖ main.py –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "‚ùå –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è main.py –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    fi
    
    if [ -f "app/api/telegram_original.py.bak" ]; then
        cp app/api/telegram_original.py.bak app/api/telegram.py
        echo "‚úÖ telegram.py –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "‚ùå –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è telegram.py –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    fi
    
    echo "‚úÖ –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω!"
    echo "üìä Webhook'–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö"
    echo "üéØ –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ"
    
elif [ "$1" = "status" ]; then
    echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞..."
    
    if grep -q "STUB" app/main.py; then
        echo "üîß –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: –ó–ê–ì–õ–£–®–ö–ê (–±–µ–∑ –ë–î)"
    else
        echo "üîß –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: –û–ë–´–ß–ù–´–ô (—Å –ë–î)"
    fi
    
else
    echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä!"
    echo ""
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:"
    echo "  $0 stub    - –≤–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –∑–∞–≥–ª—É—à–∫–∏ (–±–µ–∑ –ë–î)"
    echo "  $0 normal  - –≤–∫–ª—é—á–∏—Ç—å –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º (—Å –ë–î)"
    echo "  $0 status  - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º"
    echo ""
    echo "–ü—Ä–∏–º–µ—Ä—ã:"
    echo "  ./switch_mode.sh stub"
    echo "  ./switch_mode.sh normal"
    echo "  ./switch_mode.sh status"
fi
